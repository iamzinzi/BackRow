<!DOCTYPE html>
<html>

<head>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <!-- end bootstrap-->

  <meta charset="UTF-8">
  <title>BackRow</title>
</head>

<body>
  <div class="jumbotron pb-0">
    <h1 class="display-4">Welcome to Backrow</h1>
    <p class="lead">Never miss a question again</p>
    <div class="row justify-content-left mt-5 mb-0">
      <ul class="nav nav-tabs">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/picker/">Present</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/audience/">Audience</a>
        </li>
        <li class="nav-item">
          <a class="nav-link active" href="/#">Presentation</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/about">About Us</a>
          </li>
      </ul>
    </div>

  </div>
  <div class="row justify-content-center">
    <iframe src="{{ elink }}/embed?start=false&loop=false&delayms=3000" frameborder="0" width="960" height="569"
      allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
  </div>
  <div class="row justify-content-center mt-4">
    <textarea readonly id="chat-log" cols="115" rows="16"></textarea><br />
  </div>
  <div class="row justify-content-center mb-5">
    <input id="chat-message-input" type="text" size="108" /><br />
    <input id="chat-message-submit" type="button" class="btn btn-primary" value="Send" />
  </div>
</body>
<script>
  var roomName = '{{ elink }}';

  var chatSocket = new WebSocket(
    'ws://' + window.location.host +
    '/ws/presentation/' + roomName.split('/')[5] + '/');

  chatSocket.onmessage = function (e) {
    var data = JSON.parse(e.data);
    var message = data['message'];
    document.querySelector('#chat-log').value += (message + '\n');
  };

  chatSocket.onclose = function (e) {
    console.error('Chat socket closed unexpectedly');
  };

  document.querySelector('#chat-message-input').focus();
  document.querySelector('#chat-message-input').onkeyup = function (e) {
    if (e.keyCode === 13) {  // enter, return
      document.querySelector('#chat-message-submit').click();
    }
  };

  document.querySelector('#chat-message-submit').onclick = function (e) {
    var messageInputDom = document.querySelector('#chat-message-input');
    var message = messageInputDom.value;
    chatSocket.send(JSON.stringify({
      'message': message
    }));

    messageInputDom.value = '';
  };
</script>

</html>